---
title: "Multivariate Outliers w Mahalanobis Distance"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = TRUE,
	warning = TRUE
)
```

###IDENTIFYING MULTIVARIATE OUTLIERS USING MAHALANOBIS DISTANCE###

###############################
#Identifying multivariate outliers in your data can be helpful 
#if you want to determine whether the correlations between multiple 
#values or variables are unusually strong for individual cases/customers/participants
################################

```{r pkgs, include=FALSE}
library(readr)
```

###STEP 1###

# Identify what variables are in linear combination. 
# This could be, for example, a group of independent 
# variables used in a multiple linear regression or 
# a group of dependent variables used in a MANOVA. 
# Usually, this will include your predictor variable, 
# any outcome variables, and any mediators or moderators.


```{r raw data, include=TRUE} 
data  <- read_csv("Cues to Infidelity - MEN ONLY 7.12.23.csv")
```

###STEP 2###

# Create a dataframe containing all of the variables you identified in step 1. 

```{r selected vars, include=TRUE}
df <- data.frame(data$REACT, data$SUS, data$SOI, data$SMIRB) 
```


```{r display1, include=TRUE}
head(df, 10)
```

###STEP 3###

# Use the mahalanobis() function in R to calculate the distance for each observation:

```{r mah, include=TRUE}
df$mah <- mahalanobis(df, colMeans(df), cov(df))
```




```{r display2, include=TRUE}
head(df, 10)
```

###STEP 4###

# Calculate p-values for each distance using chi-square

```{r pval, include=TRUE}
df$pvalue <- pchisq(df$mah, df=3, lower.tail = FALSE)
```




```{r display3, include=TRUE}
head(df, 10)
```
###STEP 5###

# Identify cases where p < .001 and consider removing these from your data.

```{r order, include=TRUE}
head(df[order(df$pvalue),], 10)
```

```{r no outs, include=TRUE}
df_no_multi_outliers <- df[-(which(df$pvalue < .001)),]
```


```{r display4, include=TRUE}
head(df_no_multi_outliers, 10)
```
